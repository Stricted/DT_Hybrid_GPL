diff -uPr samba-3.0.33/source/client/mount.cifs.c samba-3.0.33.CVE-2010-0547/source/client/mount.cifs.c
--- samba-3.0.33/source/client/mount.cifs.c	2011-07-22 15:37:41.174452808 -0400
+++ samba-3.0.33.CVE-2010-0547/source/client/mount.cifs.c	2011-07-22 15:52:52.255546073 -0400
@@ -1019,6 +1019,36 @@
 	return 1;
 }
 
+/*
+ * This function borrowed from fuse-utils...
+ *
+ * glibc's addmntent (at least as of 2.10 or so) doesn't properly encode
+ * newlines embedded within the text fields. To make sure no one corrupts
+ * the mtab, fail the mount if there are embedded newlines.
+ */
+static int check_newline(const char *progname, const char *name)
+{
+    char *s;
+    for (s = "\n"; *s; s++) {
+        if (strchr(name, *s)) {
+            fprintf(stderr, "%s: illegal character 0x%02x in mount entry\n",
+                    progname, *s);
+            return EX_USAGE;
+        }
+    }
+    return 0;
+}
+
+static int check_mtab(const char *progname, const char *devname,
+			const char *dir)
+{
+	if (check_newline(progname, devname) == -1 ||
+	    check_newline(progname, dir) == -1)
+		return EX_USAGE;
+	return 0;
+}
+
+
 int main(int argc, char ** argv)
 {
 	int c;
@@ -1388,6 +1418,10 @@
 			fprintf(stderr, ",pass=********");
 	}
 
+	rc = check_mtab(thisprogram, dev_name, mountpoint);
+	if (rc)
+		goto mount_exit;
+
 	if (verboseflag)
 		fprintf(stderr, "\n");
 
